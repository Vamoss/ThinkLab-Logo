<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font: 13px Helvetica, Arial;
        width: 1920px;
        height: 1080px;
      }
    </style>
  </head>
  <body>
	<script src="/socket.io/socket.io.js"></script>
  <script src="./jquery-1.11.1.min.js"></script>
	<script src="/p5.min.js"></script>
	<script>
    const precision = 300;
    let initialValues = {
      spikes: 14,
      length: 4.5,
      phase: 2.47,
      radius: 132,
      outterRadius: 132,
    };
    //clone
    let config = JSON.parse(JSON.stringify(initialValues));
    let destVals = JSON.parse(JSON.stringify(initialValues));
    function setup() {
      colorMode(HSB, 100);
      createCanvas(1920, 1080);
      centerX = width/2;
      centerY = height/2;
      
      noFill();
      strokeWeight(8);
    }

    function draw() {
      for (let prop in config) {
        config[prop] += (destVals[prop] - config[prop]) * 0.09;
      }

      background(255);
      push();
      translate(centerX, centerY);
      for(let i=0; i<config.spikes; i++){
        rotate(1/config.spikes*TWO_PI);
        push();
        translate(0, -config.radius);
        stroke((i/config.spikes*100+30)%100, 100, 100);
        beginShape();
        for(let a = 0; a < config.length; a += TWO_PI/precision){
          let x = cos(a+config.phase) * config.outterRadius;
          let y = sin(a+config.phase) * config.outterRadius;
          vertex(x, y);
        }
        endShape();
        pop();
      }
      pop();
    }
	</script>
  <script>
    $(function () {
      var socket = io();
      socket.on('connect', function(time){
        socket.emit('master');
      });
      socket.on('spikes', function(val){
        destVals.spikes = Math.floor(map(val, 0, 100, 1, 30));
      });
      socket.on('length', function(val){
        destVals.length = map(val, 0, 100, 0.1, TWO_PI);
      });
      socket.on('phase', function(val){
        destVals.phase = map(val, 0, 100, 0, TWO_PI);
      });
      socket.on('radius', function(val){
        destVals.radius = map(val, 0, 100, 0, 400);
      });
      socket.on('outterRadius', function(val){
        destVals.outterRadius = map(val, 0, 100, -200, 200);
      });
      socket.on('reset', function(val){
        destVals = JSON.parse(JSON.stringify(initialValues));
      });
    });
  </script>
  </body>
</html>